<div class="page--popup--section" data-ix="page-popupoad">
  <div class="js--popup">
    <div class="js--cart--image"></div>
    <div class="js--cart--details">
      <h5 class="js--popup--heading">Win the entire stock collection!</h5>
      <p class="js--popup--paragraph">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros elementum tristique. Duis cursus, mi quis viverra ornare, eros dolor interdum nulla, ut commodo diam libero vitae erat.Â </p>
      <div class="form--block--widen">
        <div class="w-form js--popup--form">

          {% form 'customer' %}
          {{ form.errors | default_errors }}
          {% if form.posted_successfully? %}
          <p class="form--success">{{section.settings.success}}</p>
          {%else%}
          <input type="hidden" name="contact[tags]" value="newsletter">
          <input type="email" 
                 class="js--popup--input w-input"
                 name="contact[email]"
                 id="Email"
                 class="section-settings--field w-input" 
                 maxlength="256" 
                 value="{% if customer %}{{ customer.email }}{% endif %}"
                 placeholder="Enter your email" 
                 autocorrect="off"
                 autocapitalize="off"
                 required="">

          <input type="submit" 
                 id="Subscribe"
                 data-wait="Please wait..." 
                 class="section--newsletter--button w-button">
          {% endif %}
          {% endform %}

        </div>
      </div>
    </div>
  </div>
  <div class="close--popup" data-ix="close-news-popup">X Close</div>
</div>

<style>
  .contact-form { display: flex; }
</style>

<script>
  (function () {

    const checkLastTimeSeen = _ => {
      const sevenDaysAgo = new Date(Date.now()-(1000 * 60 * 60 * 24 * 7)).getTime()
      const lastTimeSeen = localStorage.getItem('lastTimeSeen')
      
      if (sevenDaysAgo > lastTimeSeen || !lastTimeSeen ) {
        //console.log('Last time > 7 days OR it is the first time. Displaying.')
        toggleBanner('open')
      } else {
        console.log('Under 7 days. Leave closed.')
        toggleBanner('close')
      }
    }
    
    const toggleBanner = shouldDisplay => {
      const overlay = $('.dark-overlay, .page--popup--section')
      
      if (shouldDisplay === 'open') {
        overlay.css({'display': 'flex', 'opacity': 1})
      } else {
        overlay.css({'display': 'none', 'opacity': 0})
      }
    }
    
    const hideBanner = _ => {
      toggleBanner('close')
      localStorage.setItem('lastTimeSeen', new Date().getTime())
    }

    $(document).on('click', '.close--popup, input#Subscribe', hideBanner)
    $(document).ready(checkLastTimeSeen)
  })()
</script>




